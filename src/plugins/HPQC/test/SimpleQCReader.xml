<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd">
 
  <description><![CDATA[
  Simple test wiring to write out the first generic artifact!
  ]]></description>
  
  <bean class="org.openadaptor.core.jmx.MBeanServer">
    <description>Embed this in your config to expose jmx interface via http and rmi.</description>
    <constructor-arg value="8082"/>
  </bean>
  
  <bean id="SystemUtil" class="org.openadaptor.util.SystemUtil">
    <description>Embed this in your config to expose useful management bean.</description>
  </bean>
  
  <bean id="LogAdmin" class="org.openadaptor.thirdparty.log4j.LogAdmin">
    <description>Embed this in your config to expose log4j management.</description>
  </bean>
  
  <bean id="Adaptor" class="org.openadaptor.core.adaptor.Adaptor">
    <property name="messageProcessor" ref="Router"/>
  </bean>
  
  <bean id="Router" class="org.openadaptor.core.router.Router">
    
    <property name="processMap">
      <map>
			<entry key-ref="SimplePollingReader" value-ref="QCReader"/>
			<entry key-ref="QCReader" value-ref="Writer"/>
      </map>  
    </property>
    <property name="exceptionProcessor" ref="ExceptionHandler"/>
    <property name="discardMap">
      <map>
      <!--    <entry key-ref="Filter" value-ref="DiscardLog"/> -->
      </map>
    </property>
  </bean>
  
   <bean id="SimplePollingReader" class="com.collabnet.ccf.core.test.plugins.SimpleLoopingPollingReadConnector">
     <description>
       Poller which wraps QCReader and every 5 seconds.
     </description>              
     <property name="pollLimit" value="-1"/>
     <property name="delegate" ref="QCDatabaseReader"/>
     <property name="pollIntervalSecs" value="5"/>
  </bean>
   
   <bean id="QCReader" class="com.collabnet.ccf.pi.qc.QCReader">
     <description>
       Reads the modified defects from QC
     </description>              
     <property name="serverUrl" value="http://10.2.1.114:8080/qcbin"/>
     <property name="domain" value="DOMAIN_PRJ_1"/>
     <property name="projectName" value="PRJ_1"/>
     <property name="userName" value="admin"/>
     <property name="password" value="collabnet"/>
  </bean>

  <bean id="Writer" class="org.openadaptor.auxil.connector.iostream.writer.FileWriteConnector"/>
  <bean id="ExceptionHandler" class="org.openadaptor.auxil.connector.iostream.writer.FileWriteConnector"/>

  <bean id="QCDatabaseReader" class="org.openadaptor.auxil.connector.jdbc.reader.JDBCReadConnector">
    <description>Reader which polls database using configured SQL.</description>
    <property name="jdbcConnection" ref="JdbcConnectionRead"/>
    <!-- batch size of 0 or less means process all rows in one message batch. -->
    <!-- batch size of one means process one row per message and so on -->
    <property name="batchSize" value="0"/>
    <property name="resultSetConverter" ref="QCResultSetConverter"/>
    <property name="sql">
      <value>
        SELECT * 
        FROM GENERIC_CONNECTOR_SYNC_INFO
      </value>
    </property>
  </bean>

  <bean id="JdbcConnectionRead" class="org.openadaptor.auxil.connector.jdbc.JDBCConnection">
    <description>This defines jdbc connection.</description>
    <property name="driver" value="org.hsqldb.jdbcDriver"/>
    <property name="url" value="jdbc:hsqldb:hsql://localhost/xdb"/>
    <property name="username" value="sa"/>
    <property name="password" value=""/>
  </bean>

  <bean id="QCResultSetConverter" class="org.openadaptor.auxil.connector.jdbc.reader.xml.ResultSetToXMLConverter">
	<property name="convertToString" value="false"/>
	<property name="rootElement" value="EmptySyncInf"/>  
  </bean>
  
 
</beans>
